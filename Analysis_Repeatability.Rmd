---
title: "Anxiety_F1"
author: "Hamza"
date: "14/04/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

### Load packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


#install.packages("pacman")
#install.packages("ggThemeAssist")
#install.packages("ggbeeswarm")
#install.packages("rptR")
#install.packages("lme4")
#install.packages("lmerTest")
#install.packages("wesanderson")
library(lmerTest)
library(ggThemeAssist)
library(rptR)
library(lme4)
library(readxl)
library(dplyr)
pacman::p_load(readxl, tidyr, dplyr, magrittr, lubridate, stringr, purrr)
library(sjPlot)
library(ggplot2)
library(lubridate)
library(wesanderson)
library(ggbeeswarm)
library(emmeans)
library(patchwork)
#sessionInfo()
```
The aim of this experiment is to compare repatability in typically used holding tanks against our custom made tall tanks. We designed these tanks to exploit the zebrafish's natural tendency to dive in a novel environment. Typical holding tanks aren't very deep, and as such, it's harder to comapare variability between individuals. We designed our tanks to hold the same amount of water, but have a much deeper column. For this experiment, we aren't interested in the F1 classification of the fish groups (we are referring to all of them as WT) or even the differences between groups. We are only interested in the repeatability measurements. 

### Import Data
```{r}

Old_Tanks <- read.csv("Old_tanks.csv")
Tall_Tanks <- read.csv("Tall_tanks.csv")
Anxiety_Joined <- read.csv("F1_Anxiety_Repeatability_Exp.csv")

#Inspect
str(Old_Tanks)
str(Tall_Tanks)
str(Anxiety_Joined)
```

#total distance (old, tall, joined)
```{r}
hist(Old_Tanks$tot_dist)
hist(Tall_Tanks$tot_dist)
hist(Anxiety_Joined$tot_dist)


hist(sqrt(Old_Tanks$tot_dist))
hist(sqrt(Tall_Tanks$tot_dist))
hist(sqrt(Anxiety_Joined$tot_dist))

Old_Tot_Dist <- rpt(tot_dist ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Old_Tot_Dist
plot(Old_Tot_Dist)

Tall_Tot_Dist <- rpt(tot_dist ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Tall_Tot_Dist
tall_tot_dist_plot <- plot(Tall_Tot_Dist)

Joined_Tot_Dist <- rpt(tot_dist ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Joined_Tot_Dist





# Old_Tanks %>% 
#   ggplot(aes(x = Group, y = tot_dist, colour = Group)) +
#   geom_violin(alpha = 0.1, draw_quantiles = c(0.25, 0.5, 0.75)) + 
#   geom_jitter(width = 0.2, height = 0, alpha = 0.2) +
#   theme_minimal()+
#   labs(title = "Total Distance")
# 
# Tall_Tanks %>% 
#   ggplot(aes(x = Group, y = tot_dist, colour = Group)) +
#   geom_violin(alpha = 0.1, draw_quantiles = c(0.25, 0.5, 0.75)) + 
#   geom_jitter(width = 0.2, height = 0, alpha = 0.2) +
#   theme_minimal()+
#   labs(title = "Total Distance")
# 
# Anxiety_Joined %>% 
#   ggplot(aes(x = Group, y = tot_dist, colour = Group)) +
#   geom_violin(alpha = 0.1, draw_quantiles = c(0.25, 0.5, 0.75)) + 
#   geom_jitter(width = 0.2, height = 0, alpha = 0.2) +
#   theme_minimal()+
#   facet_grid(~Tank)
#   labs(title = "Total Distance")
# 
# model1 <- lmer(tot_dist ~ Group  + (1 | Fish_ID), data = Old_Tanks)
# tab_model(model1)
# 
# model2 <- lmer(tot_dist ~ Group + (1 | Fish_ID), data = Tall_Tanks)
# tab_model(model2)
# 
# model3 <- lmer(tot_dist ~ Group + Tank + (1 | Fish_ID), data = Anxiety_Joined)
# tab_model(model3)


```

#low duration
```{r}

par(mfrow=c(2,2))
hist(Old_Tanks$low_dur)
hist(Tall_Tanks$low_dur)
hist(Anxiety_Joined$low_dur)

model <- lmer(low_dur ~ (1 | Fish_ID), data = Old_Tanks)
summary(model)
plot(residuals(model))
hist(residuals(model))

Old_low_dur <- rpt(low_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Old_low_dur

plot(Old_low_dur)

Tall_low_dur <- rpt(low_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Tall_low_dur

Joined_low_dur <- rpt(low_dur ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Joined_low_dur
```

#mid duration
```{r}

par(mfrow=c(2,2))
hist(Old_Tanks$mid_dur)
hist(Tall_Tanks$mid_dur)
hist(Anxiety_Joined$mid_dur)

model2 <- lmer(mid_dur ~ (1 | Fish_ID), data = Old_Tanks)
summary(model2)
plot(residuals(model2))
hist(residuals(model2))

Old_mid_dur <- rpt(mid_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Old_mid_dur

plot(Old_mid_dur)

Tall_mid_dur <- rpt(mid_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Tall_mid_dur

str(Tall_mid_dur)

Joined_mid_dur <- rpt(mid_dur ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Joined_mid_dur
```

#high duration
```{r}

par(mfrow=c(2,2))
hist(Old_Tanks$high_dur)
hist(Tall_Tanks$high_dur)
hist(Anxiety_Joined$high_dur)

model2 <- lmer(high_dur ~ (1 | Fish_ID), data = Old_Tanks)
summary(model2)
plot(residuals(model2))
hist(residuals(model2))

Old_high_dur <- rpt(high_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Old_high_dur

plot(Old_high_dur)

Tall_high_dur <- rpt(high_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Tall_high_dur

# str(Tall_high_dur)

Joined_high_dur <- rpt(high_dur ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Joined_high_dur
```

#freeze dur (will require some transforming)
```{r}

par(mfrow=c(2,2))
hist(Old_Tanks$freezing_dur)
hist(Tall_Tanks$freezing_dur)
hist(Anxiety_Joined$freezing_dur)

model3 <- lmer(freezing_dur ~ (1 | Fish_ID), data = Old_Tanks)
summary(model3)
plot(residuals(model3))
hist(residuals(model3))

Old_freezing_dur <- rpt(freezing_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Old_freezing_dur

plot(Old_freezing_dur)

Tall_freezing_dur <- rpt(freezing_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Tall_freezing_dur

Joined_freezing_dur <- rpt(freezing_dur ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 1000, npermut = 1000)
Joined_freezing_dur
```

#Plotting Repeatabilities 

Total distance
```{r}
Tot_Dist_rptr <- tibble(
  Tank_Type = c("Short", "Tall"),
  r = c(Old_Tot_Dist$R$Fish_ID,Tall_Tot_Dist$R$Fish_ID),
  ci.lb = c(Old_Tot_Dist$CI_emp$`2.5%`,Tall_Tot_Dist$CI_emp$`2.5%`),
  ci.ub = c(Old_Tot_Dist$CI_emp$`97.5%`,Tall_Tot_Dist$CI_emp$`97.5%`))
  
Tot_Dist_rptr

plot_Tot_Dist_rptr <- ggplot(Tot_Dist_rptr, aes(x=Tank_Type, y=r, colour=Tank_Type)) +
  geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3)) +
  geom_point(aes(x = Tank_Type, y = r), position = position_dodge(0.3))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(x = "Tank_Type", y = "r") +
  labs(title = "Repeatability estimates: total distance")+
  coord_flip()
plot_Tot_Dist_rptr



```

Low duration
```{r}
low_dur_rptr <- tibble(
  Tank_Type = c("Short", "Tall"),
  r = c(Old_low_dur$R$Fish_ID,Tall_low_dur$R$Fish_ID),
  ci.lb = c(Old_low_dur$CI_emp$`2.5%`,Tall_low_dur$CI_emp$`2.5%`),
  ci.ub = c(Old_low_dur$CI_emp$`97.5%`,Tall_low_dur$CI_emp$`97.5%`))
  
low_dur_rptr

plot_low_dur_rptr <- ggplot(low_dur_rptr, aes(x=Tank_Type, y=r, colour=Tank_Type)) +
  geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3)) +
  geom_point(aes(x = Tank_Type, y = r), position = position_dodge(0.3))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(x = "Tank_Type", y = "r") +
  labs(title = "Repeatability estimates: time spent in low zone")+
  coord_flip()
plot_low_dur_rptr
```

Middle duration
```{r}
mid_dur_rptr <- tibble(
  Tank_Type = c("Short", "Tall"),
  r = c(Old_mid_dur$R$Fish_ID,Tall_mid_dur$R$Fish_ID),
  ci.lb = c(Old_mid_dur$CI_emp$`2.5%`,Tall_mid_dur$CI_emp$`2.5%`),
  ci.ub = c(Old_mid_dur$CI_emp$`97.5%`,Tall_mid_dur$CI_emp$`97.5%`))
  
mid_dur_rptr

plot_mid_dur_rptr <- ggplot(mid_dur_rptr, aes(x=Tank_Type, y=r, colour=Tank_Type)) +
  geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3)) +
  geom_point(aes(x = Tank_Type, y = r), position = position_dodge(0.3))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(x = "Tank_Type", y = "r") +
  labs(title = "Repeatability estimates: time spent in middle zone")+
  coord_flip()
plot_mid_dur_rptr
```

High duration
```{r}
high_dur_rptr <- tibble(
  Tank_Type = c("Short", "Tall"),
  r = c(Old_high_dur$R$Fish_ID,Tall_high_dur$R$Fish_ID),
  ci.lb = c(Old_high_dur$CI_emp$`2.5%`,Tall_high_dur$CI_emp$`2.5%`),
  ci.ub = c(Old_high_dur$CI_emp$`97.5%`,Tall_high_dur$CI_emp$`97.5%`))
  
high_dur_rptr

plot_high_dur_rptr <- ggplot(high_dur_rptr, aes(x=Tank_Type, y=r, colour=Tank_Type)) +
  geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3)) +
  geom_point(aes(x = Tank_Type, y = r), position = position_dodge(0.3))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(x = "Tank_Type", y = "r") +
  labs(title = "Repeatability estimates: time spent in high zone")+
  coord_flip()
plot_high_dur_rptr
```

Freezing duration
```{r}
freezing_dur_rptr <- tibble(
  Tank_Type = c("Short", "Tall"),
  r = c(Old_freezing_dur$R$Fish_ID,Tall_freezing_dur$R$Fish_ID),
  ci.lb = c(Old_freezing_dur$CI_emp$`2.5%`,Tall_freezing_dur$CI_emp$`2.5%`),
  ci.ub = c(Old_freezing_dur$CI_emp$`97.5%`,Tall_freezing_dur$CI_emp$`97.5%`))
  
freezing_dur_rptr

plot_freezing_dur_rptr <- ggplot(freezing_dur_rptr, aes(x=Tank_Type, y=r, colour=Tank_Type)) +
  geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3)) +
  geom_point(aes(x = Tank_Type, y = r), position = position_dodge(0.3))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(x = "Tank_Type", y = "r") +
  labs(title = "Repeatability estimates: time spent freezing")+
  coord_flip()
plot_freezing_dur_rptr
```

Joining plots
```{r}
plots_dur <- (plot_high_dur_rptr / plot_mid_dur_rptr / plot_low_dur_rptr)
plots_dur

plots_other <- (plot_Tot_Dist_rptr/plot_freezing_dur_rptr)
plots_other
```






