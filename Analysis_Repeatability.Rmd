---
title: "Anxiety_F1"
author: "Hamza"
date: "14/04/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

### Load packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


#install.packages("pacman")
#install.packages("ggThemeAssist")
#install.packages("ggbeeswarm")
#install.packages("rptR")
#install.packages("lme4")
#install.packages("lmerTest")
#install.packages("wesanderson")
library(lmerTest)
library(ggThemeAssist)
library(rptR)
library(lme4)
library(readxl)
library(dplyr)
pacman::p_load(readxl, tidyr, dplyr, magrittr, lubridate, stringr, purrr)
library(sjPlot)
library(ggplot2)
library(lubridate)
library(wesanderson)
library(ggbeeswarm)
library(emmeans)
library(patchwork)
library(easyGgplot2)
library(viridis)
library(nlme)
#sessionInfo()
```
The aim of this experiment is to compare repatability in typically used holding tanks against our custom made tall tanks. We designed these tanks to exploit the zebrafish's natural tendency to dive in a novel environment. Typical holding tanks aren't very deep, and as such, it's harder to comapare variability between individuals. We designed our tanks to hold the same amount of water, but have a much deeper column. For this experiment, we aren't interested in the F1 classification of the fish groups (we are referring to all of them as WT) or even the differences between groups. We are only interested in the repeatability measurements. 

### Import Data
```{r, include=FALSE}

# Old_Tanks <- read.csv("Old_tanks.csv")
# Tall_Tanks <- read.csv("Tall_tanks.csv")
Anxiety_Joined <- read.csv("F1_Anxiety_Repeatability_Exp.csv")

#Subset by tank
Old_Tanks <- subset(Anxiety_Joined, Anxiety_Joined$Tank == "Old")
Tall_Tanks <- subset(Anxiety_Joined, Anxiety_Joined$Tank == "Tall")


#Inspect
str(Old_Tanks)
str(Tall_Tanks)
str(Anxiety_Joined)



```

#total distance (old, tall, joined)
```{r, echo=FALSE}
hist(Old_Tanks$tot_dist)
hist(Tall_Tanks$tot_dist)
hist(Anxiety_Joined$tot_dist)


# hist(sqrt(Old_Tanks$tot_dist))
# hist(sqrt(Tall_Tanks$tot_dist))
# hist(sqrt(Anxiety_Joined$tot_dist))

Old_Tot_Dist <- rpt(tot_dist ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Old_Tot_Dist


Tall_Tot_Dist <- rpt(tot_dist ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Tall_Tot_Dist


Joined_Tot_Dist <- rpt(tot_dist ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Joined_Tot_Dist

Model_Tot_Dist <- lmer(tot_dist ~ Tank + Sex +  (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_Tot_Dist)
# summary(Model_Tot_Dist)
tab_model(Model_Tot_Dist)
hist(residuals(Model_Tot_Dist))




# Shinichi's addition to show Hamza how to get the difference between these two tank's repeatablities. 
Old_boot<-unlist(Old_Tot_Dist$R_boot)
hist(Old_boot, breaks = 50)
Tall_boot<-unlist(Tall_Tot_Dist$R_boot)
hist(Tall_boot, breaks = 50)

Diff_boot <- Tall_boot - Old_boot
hist(Diff_boot, breaks = 50)

q1<- quantile(Diff_boot, c(0.025, 0.975))
q1# difference ditribuiton 95% CI
m1 <- mean(Diff_boot)
m1

# Variance models
Model_Tot_Dist1 <- lme(tot_dist ~ Tank + Sex, random = ~ 1| Fish_ID, data = Anxiety_Joined)
summary(Model_Tot_Dist1)
Model_Tot_Dist2 <- lme(tot_dist ~ Tank + Sex, random = ~ 1| Fish_ID, weights = varIdent(form=~1|Tank), data = Anxiety_Joined)
summary(Model_Tot_Dist2)
anova(Model_Tot_Dist1, Model_Tot_Dist2)

```




###low duration
```{r, echo=FALSE}

# par(mfrow=c(2,2))
hist(Old_Tanks$low_dur)
hist(Tall_Tanks$low_dur)
hist(Anxiety_Joined$low_dur)

model <- lmer(low_dur ~ (1 | Fish_ID), data = Old_Tanks)
summary(model)
plot(residuals(model))
hist(residuals(model))

Old_low_dur <- rpt(low_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Old_low_dur

plot(Old_low_dur)

Tall_low_dur <- rpt(low_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Tall_low_dur

Joined_low_dur <- rpt(low_dur ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Joined_low_dur

Model_low_dur <- lmer(low_dur ~ Tank + Sex + (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_low_dur)
tab_model(Model_low_dur)
hist(residuals(Model_low_dur))

### Analysis to find differences

Old_low_dur_boot<-unlist(Old_low_dur$R_boot)
hist(Old_low_dur_boot, breaks = 50)
Tall_low_dur_boot<-unlist(Tall_low_dur$R_boot)
hist(Tall_low_dur_boot, breaks = 50)

Diff_boot_low_dur <- Tall_low_dur_boot - Old_low_dur_boot
hist(Diff_boot_low_dur, breaks = 50)

q2 <- quantile(Diff_boot_low_dur, c(0.025, 0.975))
q2# difference ditribuiton 95% CI
m2 <-mean(Diff_boot_low_dur)
m2

#2.5% quartile greater than zero, indicates a significant difference?

# Variance models
Model_low_dur1 <- lme(low_dur ~ Tank + Sex, random = ~ 1| Fish_ID, data = Anxiety_Joined)
summary(Model_low_dur1)
Model_low_dur2 <- lme(low_dur ~ Tank + Sex, random = ~ 1| Fish_ID, weights = varIdent(form=~1|Tank), data = Anxiety_Joined)
summary(Model_low_dur2)
anova(Model_low_dur1, Model_low_dur2)

```



###mid duration
```{r, echo=FALSE}


hist(Old_Tanks$mid_dur)
hist(Tall_Tanks$mid_dur)
hist(Anxiety_Joined$mid_dur)

#We need to look at residual normality and not raw data

Old_mid_dur <- rpt(mid_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Old_mid_dur


Tall_mid_dur <- rpt(mid_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Tall_mid_dur


Joined_mid_dur <- rpt(mid_dur ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Joined_mid_dur

Model_mid_dur <- lmer(mid_dur ~ Tank + Sex + (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_mid_dur)
hist(residuals(Model_mid_dur))

###Analysis to find differences

Old_mid_dur_boot<-unlist(Old_mid_dur$R_boot)
hist(Old_mid_dur_boot, breaks = 50)
Tall_mid_dur_boot<-unlist(Tall_mid_dur$R_boot)
hist(Tall_mid_dur_boot, breaks = 50)

Diff_boot_mid_dur <- Old_mid_dur_boot - Tall_mid_dur_boot
hist(Diff_boot_mid_dur, breaks = 50)

q3 <- quantile(Diff_boot_mid_dur, c(0.025, 0.975))
q3#2.5% crosses 0, not significant?
m3 <- mean(Diff_boot_mid_dur)
m3
str(q3)

# Variance models
Model_mid_dur1 <- lme(mid_dur ~ Tank + Sex, random = ~ 1| Fish_ID, data = Anxiety_Joined)
summary(Model_mid_dur1)
Model_mid_dur2 <- lme(mid_dur ~ Tank + Sex, random = ~ 1| Fish_ID, weights = varIdent(form=~1|Tank), data = Anxiety_Joined)
summary(Model_mid_dur2)
anova(Model_mid_dur1, Model_mid_dur2)
```




###high duration
```{r, echo=FALSE}


hist(Old_Tanks$high_dur)
hist(Tall_Tanks$high_dur)
hist(Anxiety_Joined$high_dur)

model2 <- lmer(high_dur ~ (1 | Fish_ID), data = Old_Tanks)
summary(model2)
plot(residuals(model2))
hist(residuals(model2))

Old_high_dur <- rpt(high_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Old_high_dur

Old_high_dur2 <- rpt(sqrt(high_dur) ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Old_high_dur2

Tall_high_dur <- rpt(high_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Tall_high_dur

Tall_high_dur2 <- rpt(sqrt(high_dur) ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Tall_high_dur2


Joined_high_dur <- rpt(high_dur ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Joined_high_dur

Model_high_dur <- lmer(high_dur ~ Tank + (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_high_dur)
tab_model(Model_high_dur)
hist(residuals(Model_high_dur))

Model_high_dur2 <- lmer(sqrt(high_dur) ~ Tank + Sex + (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_high_dur2)
tab_model(Model_high_dur2)
hist(residuals(Model_high_dur2))


# modeling 
Model_high_durA <- lme(sqrt(high_dur) ~ Tank, random = ~ 1| Fish_ID, data = Anxiety_Joined)
summary(Model_high_durA)
Model_high_durB <- lme(sqrt(high_dur) ~ Tank, random = ~ 1| Fish_ID, weights = varIdent(form=~1|Tank), data = Anxiety_Joined)
summary(Model_high_durB)
anova(Model_high_durA, Model_high_durB)

###Analysis to find differences

Old_high_dur2_boot<-unlist(Old_high_dur2$R_boot)
hist(Old_high_dur2_boot, breaks = 50)
Tall_high_dur2_boot<-unlist(Tall_high_dur2$R_boot)
hist(Tall_high_dur2_boot, breaks = 50)

Diff_boot_high_dur2 <- Tall_high_dur2_boot - Old_high_dur2_boot
hist(Diff_boot_high_dur2, breaks = 50)

q4 <- quantile(Diff_boot_high_dur2, c(0.025, 0.975))
q4#2.5% crosses 0, not significant?
m4 <- mean(Diff_boot_high_dur2)
m4

# Variance models
Model_high_dur1a <- lme(sqrt(high_dur) ~ Tank + Sex, random = ~ 1| Fish_ID, data = Anxiety_Joined)
summary(Model_high_dur1a)
Model_high_dur2a <- lme(sqrt(high_dur) ~ Tank + Sex, random = ~ 1| Fish_ID, weights = varIdent(form=~1|Tank), data = Anxiety_Joined)
summary(Model_high_dur2a)
anova(Model_high_dur1a, Model_high_dur2a)
```



###freeze dur 
```{r, echo=FALSE}


hist(Old_Tanks$freezing_dur)
hist(Tall_Tanks$freezing_dur)
hist(Anxiety_Joined$freezing_dur)

model3 <- lmer(freezing_dur ~ (1 | Fish_ID), data = Old_Tanks)
summary(model3)
plot(residuals(model3))
hist(residuals(model3))

Old_freezing_dur <- rpt(freezing_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Old_freezing_dur

Old_freezing_dur2 <- rpt(sqrt(freezing_dur) ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Old_freezing_dur2

Old_freezing_dur3 <- rpt(log(freezing_dur+1) ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Old_freezing_dur3

plot(Old_freezing_dur)

Tall_freezing_dur <- rpt(freezing_dur ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Tall_freezing_dur

Tall_freezing_dur2 <- rpt(sqrt(freezing_dur) ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Tall_freezing_dur2

Tall_freezing_dur3 <- rpt(log(freezing_dur+1) ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Tall_freezing_dur3

Joined_freezing_dur <- rpt(freezing_dur ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Joined_freezing_dur

Model_freezing_dur <- lmer(freezing_dur ~ Tank + (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_freezing_dur)
hist(residuals(Model_freezing_dur))


Model_freezing_dur2 <- lmer(sqrt(freezing_dur) ~ Tank + (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_freezing_dur2)
hist(residuals(Model_freezing_dur2))

Model_freezing_dur3 <- lmer(log(freezing_dur+1) ~ Tank + Sex + (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_freezing_dur3)
tab_model(Model_freezing_dur3)
hist(residuals(Model_freezing_dur3))

###Analysis to find differences

Old_freezing_dur3_boot<-unlist(Old_freezing_dur3$R_boot)
hist(Old_freezing_dur3_boot, breaks = 50)
Tall_freezing_dur3_boot<-unlist(Tall_freezing_dur3$R_boot)
hist(Tall_freezing_dur3_boot, breaks = 50)

Diff_boot_freezing_dur3 <- Tall_freezing_dur3_boot - Old_freezing_dur3_boot
hist(Diff_boot_freezing_dur3, breaks = 50)

q5 <- quantile(Diff_boot_freezing_dur3, c(0.025, 0.975))#2.5% crosses 0, not significant?
q5
m5 <- mean(Diff_boot_freezing_dur3)
m5


#Variance models
Model_freezing_dur1a <- lme(log(freezing_dur+1) ~ Tank + Sex, random = ~ 1| Fish_ID, data = Anxiety_Joined)
summary(Model_freezing_dur1a)
Model_freezing_dur2a <- lme(log(freezing_dur+1) ~ Tank + Sex, random = ~ 1| Fish_ID, weights = varIdent(form=~1|Tank), data = Anxiety_Joined)
summary(Model_freezing_dur2a)
anova(Model_freezing_dur1a, Model_freezing_dur2a)
```

#latency to high
```{r}
Model_latency <- lmer(latency_high ~ Tank + (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_latency)
hist(residuals(Model_latency)) 

Model_latency2 <- lmer(sqrt(latency_high) ~ Tank + (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_latency2)
hist(residuals(Model_latency2)) #Transformation seems better?

Old_latency <- rpt(latency_high ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Old_latency



Tall_latency <- rpt(latency_high ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Tall_latency
plot(Tall_latency)


Joined_latency <- rpt(latency_high ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Joined_latency

###Analysis to find differences

Old_latency_boot<-unlist(Old_latency$R_boot)
hist(Old_latency_boot, breaks = 50)
Tall_latency_boot<-unlist(Tall_latency$R_boot)
hist(Tall_latency_boot, breaks = 50)

Diff_boot_latency <- Tall_latency_boot - Old_latency_boot
hist(Diff_boot_latency, breaks = 50)

q6 <- quantile(Diff_boot_latency, c(0.025, 0.975)) #2.5% crosses 0, not significant?
q6
m6 <- mean(Diff_boot_latency)
m6

# Variance models
Model_latency_high1a <- lme(latency_high ~ Tank + Sex, random = ~ 1| Fish_ID, data = Anxiety_Joined, na.action=na.omit)
summary(Model_latency_high1a)
Model_latency_high2a <- lme(latency_high ~ Tank + Sex, random = ~ 1| Fish_ID, weights = varIdent(form=~1|Tank), data = Anxiety_Joined, na.action=na.omit)
summary(Model_latency_high2a)
anova(Model_latency_high1a, Model_latency_high2a)
```

#entries into high
```{r}
Model_freq_high <- lmer(freq_high ~ Tank + (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_freq_high)
hist(residuals(Model_freq_high)) #needs transformation, right skewed heavily

Model_freq_high2 <- lmer(sqrt(freq_high) ~ Tank + (1 | Fish_ID), data = Anxiety_Joined)
summary(Model_freq_high2)
hist(residuals(Model_freq_high2))

Old_freq_high <- rpt(sqrt(freq_high) ~ (1 | Fish_ID), grname = "Fish_ID", data = Old_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Old_freq_high
plot(Old_freq_high)


Tall_freq_high <- rpt(sqrt(freq_high) ~ (1 | Fish_ID), grname = "Fish_ID", data = Tall_Tanks, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Tall_freq_high
plot(Tall_freq_high)


Joined_freq_high <- rpt(sqrt(freq_high) ~ Tank + (1 | Fish_ID), grname = "Fish_ID", data = Anxiety_Joined, datatype = "Gaussian", 
    nboot = 10000, npermut = 10000)
Joined_freq_high

###Analysis to find differences

Old_freq_high_boot<-unlist(Old_freq_high$R_boot)
hist(Old_freq_high_boot, breaks = 50)
Tall_freq_high_boot<-unlist(Tall_freq_high$R_boot)
hist(Tall_freq_high_boot, breaks = 50)

Diff_boot_freq_high <- Old_freq_high_boot - Tall_freq_high_boot
hist(Diff_boot_freq_high, breaks = 50)

q7 <- quantile(Diff_boot_freq_high, c(0.025, 0.975)) 
q7
m7 <- mean(Diff_boot_freq_high)
m7


#Variance models
Model_freq_high1a <- lme(sqrt(freq_high) ~ Tank + Sex, random = ~ 1| Fish_ID, data = Anxiety_Joined)
summary(Model_freq_high1a)
Model_freq_high2a <- lme(sqrt(freq_high) ~ Tank + Sex, random = ~ 1| Fish_ID, weights = varIdent(form=~1|Tank), data = Anxiety_Joined)
summary(Model_freq_high2a)
anova(Model_freq_high1a, Model_freq_high2a)


```





#Plotting Repeatabilities 

Total distance
```{r, echo=FALSE}
Tot_Dist_rptr <- tibble(
  Condition = c("Short", "Tall", "Contrast"),
  r = c(Old_Tot_Dist$R$Fish_ID,Tall_Tot_Dist$R$Fish_ID, m1),
  ci.lb = c(Old_Tot_Dist$CI_emp$`2.5%`,Tall_Tot_Dist$CI_emp$`2.5%`,-0.01),
  ci.ub = c(Old_Tot_Dist$CI_emp$`97.5%`,Tall_Tot_Dist$CI_emp$`97.5%`, 0.38),
Endpoint = c("Total Distance", "Total Distance", "Total Distance"))
  
Tot_Dist_rptr

plot_Tot_Dist_rptr <- ggplot(Tot_Dist_rptr, aes(x=Condition, y=r, colour=Condition)) +
  geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3), size=1.1) +
  geom_point(aes(x = Condition, y = r), position = position_dodge(0.3),size=3)+
  scale_color_manual(values=c("#000000", "#339900", "#FF9900"))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(y = "r") +
  labs(title = "Repeatability estimates", subtitle = "Total distance")+
  coord_flip()+
   theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  ylim(-0.2, 0.8) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank())+
  theme(legend.position="top")
  
plot_Tot_Dist_rptr
```



Low duration
```{r, echo=FALSE}
low_dur_rptr <- tibble(
  Condition = c("Short", "Tall", "Contrast"),
  r = c(Old_low_dur$R$Fish_ID,Tall_low_dur$R$Fish_ID, m2),
  ci.lb = c(Old_low_dur$CI_emp$`2.5%`,Tall_low_dur$CI_emp$`2.5%`, 0.09),
  ci.ub = c(Old_low_dur$CI_emp$`97.5%`,Tall_low_dur$CI_emp$`97.5%`, 0.54),
Endpoint = c("Low Duration", "Low Duration", "Low Duration"))
  
low_dur_rptr

plot_low_dur_rptr <- ggplot(low_dur_rptr, aes(x=Condition, y=r, colour=Condition)) +
   geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3), size=1.1) +
  geom_point(aes(x = Condition, y = r), position = position_dodge(0.3),size=3)+
  scale_color_manual(values=c("#000000", "#339900", "#FF9900"))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(x = "Tank Type", y = "r") +
  labs(subtitle = "Time spent in low zone")+
  coord_flip()+
   theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
   ylim(-0.2, 0.8) + 
  theme(legend.position = "none")+
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank())
plot_low_dur_rptr
```

Middle duration
```{r, echo=FALSE}
mid_dur_rptr <- tibble(
  Condition = c("Short", "Tall", "Contrast"),
  r = c(Old_mid_dur$R$Fish_ID,Tall_mid_dur$R$Fish_ID, m3),
  ci.lb = c(Old_mid_dur$CI_emp$`2.5%`,Tall_mid_dur$CI_emp$`2.5%`, -0.13),
  ci.ub = c(Old_mid_dur$CI_emp$`97.5%`,Tall_mid_dur$CI_emp$`97.5%`,0.21),
Endpoint = c("Mid Duration", "Mid Duration", "Mid Duration"))
  
mid_dur_rptr

plot_mid_dur_rptr <- ggplot(mid_dur_rptr, aes(x=Condition, y=r, colour=Condition)) +
  geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3), size=1.1) +
  geom_point(aes(x = Condition, y = r), position = position_dodge(0.3),size=3)+
  scale_color_manual(values=c("#000000", "#339900", "#FF9900"))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(x = "Tank Type", y = "r") +
  labs(subtitle = "Time spent in middle zone")+
  coord_flip()+
   theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
   ylim(-0.2, 0.8) + theme(legend.position = "none")+ 
  theme(legend.position = "none")+
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank())
plot_mid_dur_rptr
```

High duration
```{r, echo=FALSE}
high_dur_rptr <- tibble(
  Condition = c("Short", "Tall", "Contrast"),
  r = c(Old_high_dur2$R$Fish_ID,Tall_high_dur2$R$Fish_ID, m4),
  ci.lb = c(Old_high_dur2$CI_emp$`2.5%`,Tall_high_dur2$CI_emp$`2.5%`, -0.09),
  ci.ub = c(Old_high_dur2$CI_emp$`97.5%`,Tall_high_dur2$CI_emp$`97.5%`, 0.22),
Endpoint = c("High Duration", "High Duration", "High Duration"))
  
high_dur_rptr

plot_high_dur_rptr <- ggplot(high_dur_rptr, aes(x=Condition, y=r, colour=Condition)) +
  geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3), size=1.1) +
  geom_point(aes(x = Condition, y = r), position = position_dodge(0.3),size=3)+
scale_color_manual(values=c("#000000", "#339900", "#FF9900"))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(x = "Tank Type", y = "r") +
  labs(subtitle = "Time spent in high zone")+
  coord_flip()+
   theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
   ylim(-0.2, 0.8) + 
  theme(legend.position = "none")+
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank())
plot_high_dur_rptr
```

Freezing duration
```{r, echo=FALSE}
freezing_dur_rptr <- tibble(
  Condition = c("Short", "Tall", "Contrast"),
  r = c(Old_freezing_dur3$R$Fish_ID,Tall_freezing_dur3$R$Fish_ID, m5),
  ci.lb = c(Old_freezing_dur3$CI_emp$`2.5%`,Tall_freezing_dur3$CI_emp$`2.5%`, -0.20),
  ci.ub = c(Old_freezing_dur3$CI_emp$`97.5%`,Tall_freezing_dur3$CI_emp$`97.5%`, 0.20),
Endpoint = c("Freezing Duration", "Freezing Duration", "Freezing Duration"))
  
freezing_dur_rptr

plot_freezing_dur_rptr <- ggplot(freezing_dur_rptr, aes(x=Condition, y=r, colour=Condition)) +
  geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3), size=1.1) +
  geom_point(aes(x = Condition, y = r), position = position_dodge(0.3),size=3)+
scale_color_manual(values=c("#000000", "#339900", "#FF9900"))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(x = "Tank Type", y = "r") +
  labs(subtitle = "Time spent freezing")+
  coord_flip()+
   theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  ylim(-0.2, 0.8) + 
  theme(legend.position = "none")+
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank())
plot_freezing_dur_rptr
```

Entries into high zone
```{r}
frequency_rptr <- tibble(
  Condition = c("Short", "Tall", "Contrast"),
  r = c(Old_freq_high$R$Fish_ID,Tall_freq_high$R$Fish_ID, m7),
  ci.lb = c(Old_freq_high$CI_emp$`2.5%`,Tall_freq_high$CI_emp$`2.5%`, -0.02),
  ci.ub = c(Old_freq_high$CI_emp$`97.5%`,Tall_freq_high$CI_emp$`97.5%`, 0.35),
Endpoint = c("High Zone Frequency", "High Zone Frequency", "High Zone Frequency"))
  
frequency_rptr

plot_frequency_rptr <- ggplot(frequency_rptr, aes(x=Condition, y=r, colour=Condition)) +
  geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3), size=1.1) +
  geom_point(aes(x = Condition, y = r), position = position_dodge(0.3),size=3)+
scale_color_manual(values=c("#000000", "#339900", "#FF9900"))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(x = "Tank Type", y = "r") +
  labs(subtitle = "Entries into high zone")+
  coord_flip()+
   theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
   ylim(-0.2, 0.8) + 
  theme(legend.position = "none")+
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank())
plot_frequency_rptr
```


Latency to high
```{r}
latency_rptr <- tibble(
  Condition = c("Short", "Tall", "Contrast"),
  r = c(Old_latency$R$Fish_ID,Tall_latency$R$Fish_ID, m6),
  ci.lb = c(Old_latency$CI_emp$`2.5%`,Tall_latency$CI_emp$`2.5%`, 0.14),
  ci.ub = c(Old_latency$CI_emp$`97.5%`,Tall_latency$CI_emp$`97.5%`, 0.57),
Endpoint = c("Latency to High Zone", "Latency to High Zone", "Latency to High Zone"))

latency_rptr

plot_latency_rptr <- ggplot(latency_rptr, aes(x=Condition, y=r, colour=Condition)) +
  geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0, position = position_dodge(0.3), size=1.1) +
  geom_point(aes(x = Condition, y = r), position = position_dodge(0.3),size=3)+
scale_color_manual(values=c("#000000", "#339900", "#FF9900"))+
  geom_hline(yintercept = 0, lty = "dotted") +
  labs(x = "Tank Type", y = "r") +
  labs(subtitle = "Latency to high zone")+
  coord_flip()+
   theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  ylim(-0.2, 0.8) + 
  theme(legend.position = "none")
plot_latency_rptr
```



More plots
```{r, echo=FALSE}

#Renaming facets

sex_labs <- c("Female", "Male") 
names(sex_labs) <- c("female", "male")

tank_labs <- c("Short", "Tall")
names(tank_labs) <- c("Old", "Tall")


#Plots

Violin_Dist <- ggplot(Anxiety_Joined, aes(x=Sex, y=tot_dist, fill=Sex)) + 
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1, fill="white")+
  labs(title="Total distance travelled",y = "Total distance (cm)")+
theme_grey()+
  facet_grid(~Tank, labeller = labeller(Tank = tank_labs))+
 theme(legend.position = "none")+
  scale_x_discrete(labels=c("female" = "Female", "male" = "Male"))
 

Violin_Dist

ggsave(path = "Plots", file = "Total Distance.jpeg", limitsize = FALSE)



Violin_Low <- ggplot(Anxiety_Joined, aes(x=Sex, y=low_dur, fill=Sex)) + 
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1, fill="white")+
  labs(title="Time spent in low zone",y = "Time spent (seconds)")+
theme_grey()+
  facet_grid(~Tank, labeller = labeller(Tank = tank_labs))+
 theme(legend.position = "none")+
  scale_x_discrete(labels=c("female" = "Female", "male" = "Male"))

Violin_Low

ggsave(path = "Plots", file = "Low Duration.jpeg", limitsize = FALSE)


Violin_Mid <- ggplot(Anxiety_Joined, aes(x=Sex, y=mid_dur, fill=Sex)) + 
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1, fill="white")+
  labs(title="Time spent in middle zone",y = "Time spent (seconds)")+
theme_grey()+
  facet_grid(~Tank, labeller = labeller(Tank = tank_labs))+
 theme(legend.position = "none")+
  scale_x_discrete(labels=c("female" = "Female", "male" = "Male"))

Violin_Mid
ggsave(path = "Plots", file = "Mid_Duration.jpeg", limitsize = FALSE)


Violin_High <- ggplot(Anxiety_Joined, aes(x=Sex, y=high_dur, fill=Sex)) + 
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1, fill="white")+
  labs(title="Time spent in high zone",y = "Time spent (seconds)")+
theme_grey()+
  facet_grid(~Tank, labeller = labeller(Tank = tank_labs))+
 theme(legend.position = "none")+
  scale_x_discrete(labels=c("female" = "Female", "male" = "Male"))

Violin_High

ggsave(path = "Plots", file = "High_Duration.jpeg", limitsize = FALSE)



Violin_Freezing <- ggplot(Anxiety_Joined, aes(x=Sex, y=(log(freezing_dur+1)), fill=Sex)) + 
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1, fill="white")+
  labs(title="Time spent freezing (log transformed)",x="Tank type", y = "Time spent (seconds)")+
theme_grey()+
  facet_grid(~Tank, labeller = labeller(Tank = tank_labs))+
 theme(legend.position = "none")+
  scale_x_discrete(labels=c("female" = "Female", "male" = "Male"))

Violin_Freezing

ggsave(path = "Plots", file = "Freezing.jpeg", limitsize = FALSE)



Violin_Latency <- ggplot(Anxiety_Joined, aes(x=Sex, y=latency_high, fill=Sex)) + 
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1, fill="white")+
  labs(title="Latency to high zone",x="Tank type", y = "Seconds")+
theme_grey()+
  facet_grid(~Tank, labeller = labeller(Tank = tank_labs))+
 theme(legend.position = "none")+
  scale_x_discrete(labels=c("female" = "Female", "male" = "Male"))

Violin_Latency

ggsave(path = "Plots", file = "Latency to High.jpeg", limitsize = FALSE)


Hist_entries <- ggplot(Anxiety_Joined, aes(y=freq_high, fill=Sex))+
  geom_histogram()+
  stat_bin(binwidth=6)+
theme_grey()+
  facet_grid(~Tank, labeller = labeller(Tank = tank_labs))+
  labs(title="Entries into the high zone",x="Counts", y = "Number of entries")+
  scale_fill_discrete(name = "Sex", labels = c("Female","Male"))+
  coord_flip()
  
  
Hist_entries

#Double check whether I got the x and y axes correct



ggsave(path = "Plots", file = "Entries to high.jpeg", limitsize = FALSE)
```







